<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Katmanlar Altƒ±nda</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;background:#111;color:white;font-family:Arial;overflow:hidden}
canvas{background:#222;display:none}
#menu,#popup{
 position:fixed;inset:0;display:flex;
 flex-direction:column;justify-content:center;
 align-items:center;background:#111;z-index:10
}
#popup{display:none;text-align:center;padding:20px}
button{font-size:20px;padding:12px 30px;border:none;border-radius:10px}
#mobileControls{
 position:fixed;bottom:20px;left:50%;
 transform:translateX(-50%);
 display:none;gap:10px;z-index:5
}
.ctrl{
 width:60px;height:60px;border-radius:50%;
 background:#444;color:white;font-size:22px
}
</style>
</head>
<body>

<div id="menu">
 <h1>Katmanlar Altƒ±nda</h1>
 <button onclick="start('pc')">üíª PC</button>
 <button onclick="start('mobile')">üì± Mobil</button>
</div>

<canvas id="game"></canvas>

<div id="popup">
 <h2 id="popupTitle"></h2>
 <p id="popupText"></p>
 <button onclick="closePopup()">Devam</button>
</div>

<div id="mobileControls">
 <button class="ctrl" ontouchstart="move('up')">‚¨ÜÔ∏è</button>
 <div style="display:flex;gap:10px">
  <button class="ctrl" ontouchstart="move('left')">‚¨ÖÔ∏è</button>
  <button class="ctrl" ontouchstart="move('right')">‚û°Ô∏è</button>
 </div>
 <button class="ctrl" ontouchstart="move('down')">‚¨áÔ∏è</button>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth;
canvas.height=innerHeight;

const TILE=40, WORLD_WIDTH=20, WORLD_HEIGHT=200;
let platform=null, cameraY=0, paused=false;

const images={};
const loadImage=(src)=>{
 const img=new Image();
 img.src=src;
 return img;
};

// TEXTURE Y√úKLEME
["vase","bone","tablet"].forEach(t=>{
 for(let i=0;i<3;i++){
  images[`${t}_${i}`]=loadImage(`assets/artifacts/${t}_${i}.png`);
 }
});

const artifactTypes=[
 {type:"vase",name:"Antik Vazo",info:"Seramik kap"},
 {type:"bone",name:"Kemik",info:"Canlƒ± kalƒ±ntƒ±sƒ±"},
 {type:"tablet",name:"Tablet",info:"Yazƒ±lƒ± ta≈ü"}
];

const world=[];
for(let y=0;y<WORLD_HEIGHT;y++){
 world[y]=[];
 for(let x=0;x<WORLD_WIDTH;x++){
  let artifact=null;
  if(y>40 && Math.random()<0.025){
   const a=artifactTypes[Math.floor(Math.random()*artifactTypes.length)];
   artifact={...a, revealed:false, damage:0};
  }
  world[y][x]={dug:false,artifact};
 }
}

const player={x:10,y:0};

function start(p){
 platform=p;
 menu.style.display="none";
 canvas.style.display="block";
 if(p==="mobile") mobileControls.style.display="flex";
 loop();
}

function move(dir){
 if(paused) return;
 let nx=player.x, ny=player.y;
 if(dir==="left")nx--;
 if(dir==="right")nx++;
 if(dir==="up")ny--;
 if(dir==="down")ny++;
 if(nx<0||ny<0||nx>=WORLD_WIDTH||ny>=WORLD_HEIGHT) return;

 const tile=world[ny][nx];
 tile.dug=true;

 // YAN KAZI ‚Üí ESER ORTAYA √áIKAR
 [[1,0],[-1,0],[0,1],[0,-1]].forEach(d=>{
  const t=world[ny+d[1]]?.[nx+d[0]];
  if(t?.artifact) t.artifact.revealed=true;
 });

 // ESER √úST√úNE BASMA
 if(tile.artifact && tile.artifact.revealed){
  tile.artifact.damage++;
  if(tile.artifact.damage>=2){
   showPopup("Eser Kƒ±rƒ±ldƒ±","Yanlƒ±≈ü kazƒ± sonucu eser yok oldu.");
   tile.artifact=null;
  }else{
   showPopup("Eser Hasar Aldƒ±","Daha dikkatli kazmalƒ±sƒ±n!");
   return;
  }
 }

 player.x=nx; player.y=ny;
}

function showPopup(t,m){
 paused=true;
 popupTitle.innerText=t;
 popupText.innerText=m;
 popup.style.display="flex";
}
function closePopup(){
 popup.style.display="none";
 paused=false;
}

addEventListener("keydown",e=>{
 if(platform!=="pc")return;
 if(e.key==="ArrowLeft"||e.key==="a")move("left");
 if(e.key==="ArrowRight"||e.key==="d")move("right");
 if(e.key==="ArrowUp"||e.key==="w")move("up");
 if(e.key==="ArrowDown"||e.key==="s")move("down");
});

function loop(){
 ctx.clearRect(0,0,canvas.width,canvas.height);
 cameraY=player.y*TILE-canvas.height/2;
 if(cameraY<0)cameraY=0;

 for(let y=0;y<WORLD_HEIGHT;y++){
  for(let x=0;x<WORLD_WIDTH;x++){
   const dy=y*TILE-cameraY;
   if(dy>-TILE&&dy<canvas.height){
    ctx.fillStyle=world[y][x].dug?"#111":"#654321";
    ctx.fillRect(x*TILE,dy,TILE,TILE);

    const a=world[y][x].artifact;
    if(a && a.revealed){
     ctx.drawImage(
      images[`${a.type}_${a.damage}`],
      x*TILE+4, dy+4, 32, 32
     );
    }
   }
  }
 }

 ctx.fillStyle="yellow";
 ctx.fillRect(player.x*TILE,player.y*TILE-cameraY,TILE,TILE);

 requestAnimationFrame(loop);
}
</script>
</body>
</html>