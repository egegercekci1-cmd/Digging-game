<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Katmanlar Altƒ±nda</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;background:#0e0e0e;color:white;font-family:Arial;overflow:hidden}
canvas{display:none;background:#222}
#menu,#popup{
 position:fixed;inset:0;display:flex;
 flex-direction:column;justify-content:center;
 align-items:center;background:#0e0e0e;z-index:10
}
#popup{display:none;text-align:center;padding:20px}
button{
 font-size:20px;padding:12px 30px;
 border:none;border-radius:12px;
 background:#c58c3a;color:black
}
#mobileControls{
 position:fixed;bottom:20px;left:50%;
 transform:translateX(-50%);
 display:none;gap:10px;z-index:5
}
.ctrl{
 width:60px;height:60px;border-radius:50%;
 background:#444;color:white;font-size:22px
}
</style>
</head>
<body>

<div id="menu">
 <h1>Katmanlar Altƒ±nda</h1>
 <p>Arkeolojik Kazƒ± Oyunu</p>
 <button onclick="start('pc')">üíª PC</button>
 <button onclick="start('mobile')">üì± Mobil</button>
</div>

<canvas id="game"></canvas>

<div id="popup">
 <h2 id="popupTitle"></h2>
 <p id="popupText"></p>
 <button onclick="closePopup()">Devam</button>
</div>

<div id="mobileControls">
 <button class="ctrl" ontouchstart="move('up')">‚¨ÜÔ∏è</button>
 <div style="display:flex;gap:10px">
  <button class="ctrl" ontouchstart="move('left')">‚¨ÖÔ∏è</button>
  <button class="ctrl" ontouchstart="move('right')">‚û°Ô∏è</button>
 </div>
 <button class="ctrl" ontouchstart="move('down')">‚¨áÔ∏è</button>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth;
canvas.height=innerHeight;

const TILE=40, WORLD_W=20, WORLD_H=250;
let cameraY=0, paused=false, platform="pc";

// === IMAGE SYSTEM ===
const images={};
function load(src){const i=new Image();i.src=src;return i;}
images.player=load("assets/player.png");

["vase","bone","tablet"].forEach(t=>{
 for(let i=0;i<3;i++){
  images[`${t}_${i}`]=load(`assets/artifacts/${t}_${i}.png`);
 }
});

// === ARTIFACT TYPES ===
const artifactTypes=[
 {type:"vase",name:"Antik Vazo",info:"Seramik kap"},
 {type:"bone",name:"Kemik",info:"Canlƒ± kalƒ±ntƒ±sƒ±"},
 {type:"tablet",name:"Tablet",info:"Yazƒ±lƒ± ta≈ü"}
];

// === WORLD ===
const world=[];
for(let y=0;y<WORLD_H;y++){
 world[y]=[];
 for(let x=0;x<WORLD_W;x++){
  let artifact=null;
  if(y>30 && Math.random()<0.025){
   const a=artifactTypes[Math.floor(Math.random()*artifactTypes.length)];
   artifact={...a,damage:0,revealed:false};
  }
  world[y][x]={dug:false,artifact};
 }
}

// === PLAYER ===
const player={x:10,y:0};

// === START ===
function start(p){
 platform=p;
 menu.style.display="none";
 canvas.style.display="block";
 if(p==="mobile") mobileControls.style.display="flex";
 loop();
}

// === MOVE ===
function move(dir){
 if(paused) return;
 let nx=player.x, ny=player.y;
 if(dir==="left")nx--;
 if(dir==="right")nx++;
 if(dir==="up")ny--;
 if(dir==="down")ny++;
 if(nx<0||ny<0||nx>=WORLD_W||ny>=WORLD_H) return;

 const tile=world[ny][nx];
 tile.dug=true;

 // Yan kazƒ± ‚Üí eser ortaya √ßƒ±kar
 [[1,0],[-1,0],[0,1],[0,-1]].forEach(d=>{
  const t=world[ny+d[1]]?.[nx+d[0]];
  if(t?.artifact) t.artifact.revealed=true;
 });

 // Eser √ºst√ºne kazƒ±
 if(tile.artifact && tile.artifact.revealed){
  tile.artifact.damage++;
  if(tile.artifact.damage>=2){
   showPopup("Eser Kƒ±rƒ±ldƒ±","Yanlƒ±≈ü kazƒ± sonucu eser yok oldu.");
   tile.artifact=null;
  }else{
   showPopup("Eser Hasar Aldƒ±","Daha dikkatli kazmalƒ±sƒ±n!");
  }
 }

 player.x=nx; player.y=ny;
}

// === POPUP ===
function showPopup(t,m){
 paused=true;
 popupTitle.innerText=t;
 popupText.innerText=m;
 popup.style.display="flex";
}
function closePopup(){
 popup.style.display="none";
 paused=false;
}

// === INPUT ===
addEventListener("keydown",e=>{
 if(platform!=="pc")return;
 if(e.key==="ArrowLeft"||e.key==="a")move("left");
 if(e.key==="ArrowRight"||e.key==="d")move("right");
 if(e.key==="ArrowUp"||e.key==="w")move("up");
 if(e.key==="ArrowDown"||e.key==="s")move("down");
});

// === LOOP ===
function loop(){
 ctx.clearRect(0,0,canvas.width,canvas.height);
 cameraY=player.y*TILE-canvas.height/2;
 if(cameraY<0)cameraY=0;

 for(let y=0;y<WORLD_H;y++){
  for(let x=0;x<WORLD_W;x++){
   const dy=y*TILE-cameraY;
   if(dy>-TILE && dy<canvas.height){
    ctx.fillStyle=world[y][x].dug?"#1a1a1a":"#6b4a2d";
    ctx.fillRect(x*TILE,dy,TILE,TILE);

    const a=world[y][x].artifact;
    if(a && a.revealed){
     ctx.drawImage(
      images[`${a.type}_${a.damage}`],
      x*TILE+4, dy+4, 32, 32
     );
    }
   }
  }
 }

 // PLAYER SPRITE
 ctx.drawImage(
  images.player,
  player.x*TILE+4,
  player.y*TILE-cameraY+4,
  TILE-8,
  TILE-8
 );

 requestAnimationFrame(loop);
}
</script>
</body>
</html>